
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>syft.service.project.project &#8212; PySyft  documentation</title>
    
  <link href="../../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/pysyft.css" />
    
  <link rel="preload" as="script" href="../../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../../index.html">
  <img src="../../../../_static/logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../getting_started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../api_reference/index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../developer_guide/index.html">
  Contributor Guidelines
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../deployment/glossary.html">
  Glossary
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../resources/index.html">
  Resources
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../guides/index.html">
  How-to Guides
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/OpenMined/PySyft" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/openminedorg" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for syft.service.project.project</h1><div class="highlight"><pre>
<span></span><span class="c1"># future</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="c1"># stdlib</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Set</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="c1"># third party</span>
<span class="kn">import</span> <span class="nn">pydantic</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">validator</span>
<span class="kn">from</span> <span class="nn">rich.progress</span> <span class="kn">import</span> <span class="n">Progress</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="c1"># relative</span>
<span class="kn">from</span> <span class="nn">...client.client</span> <span class="kn">import</span> <span class="n">SyftClient</span>
<span class="kn">from</span> <span class="nn">...client.client</span> <span class="kn">import</span> <span class="n">SyftClientSessionCache</span>
<span class="kn">from</span> <span class="nn">...node.credentials</span> <span class="kn">import</span> <span class="n">SyftSigningKey</span>
<span class="kn">from</span> <span class="nn">...node.credentials</span> <span class="kn">import</span> <span class="n">SyftVerifyKey</span>
<span class="kn">from</span> <span class="nn">...serde.serializable</span> <span class="kn">import</span> <span class="n">serializable</span>
<span class="kn">from</span> <span class="nn">...serde.serialize</span> <span class="kn">import</span> <span class="n">_serialize</span>
<span class="kn">from</span> <span class="nn">...service.metadata.node_metadata</span> <span class="kn">import</span> <span class="n">NodeMetadata</span>
<span class="kn">from</span> <span class="nn">...store.linked_obj</span> <span class="kn">import</span> <span class="n">LinkedObject</span>
<span class="kn">from</span> <span class="nn">...types.datetime</span> <span class="kn">import</span> <span class="n">DateTime</span>
<span class="kn">from</span> <span class="nn">...types.syft_object</span> <span class="kn">import</span> <span class="n">SYFT_OBJECT_VERSION_1</span>
<span class="kn">from</span> <span class="nn">...types.syft_object</span> <span class="kn">import</span> <span class="n">SyftObject</span>
<span class="kn">from</span> <span class="nn">...types.syft_object</span> <span class="kn">import</span> <span class="n">short_qual_name</span>
<span class="kn">from</span> <span class="nn">...types.transforms</span> <span class="kn">import</span> <span class="n">TransformContext</span>
<span class="kn">from</span> <span class="nn">...types.transforms</span> <span class="kn">import</span> <span class="n">keep</span>
<span class="kn">from</span> <span class="nn">...types.transforms</span> <span class="kn">import</span> <span class="n">transform</span>
<span class="kn">from</span> <span class="nn">...types.uid</span> <span class="kn">import</span> <span class="n">UID</span>
<span class="kn">from</span> <span class="nn">...util</span> <span class="kn">import</span> <span class="n">options</span>
<span class="kn">from</span> <span class="nn">...util.colors</span> <span class="kn">import</span> <span class="n">SURFACE</span>
<span class="kn">from</span> <span class="nn">...util.markdown</span> <span class="kn">import</span> <span class="n">markdown_as_class_with_fields</span>
<span class="kn">from</span> <span class="nn">...util.util</span> <span class="kn">import</span> <span class="n">full_name_with_qualname</span>
<span class="kn">from</span> <span class="nn">..code.user_code</span> <span class="kn">import</span> <span class="n">SubmitUserCode</span>
<span class="kn">from</span> <span class="nn">..network.network_service</span> <span class="kn">import</span> <span class="n">NodePeer</span>
<span class="kn">from</span> <span class="nn">..network.routes</span> <span class="kn">import</span> <span class="n">NodeRoute</span>
<span class="kn">from</span> <span class="nn">..network.routes</span> <span class="kn">import</span> <span class="n">connection_to_route</span>
<span class="kn">from</span> <span class="nn">..request.request</span> <span class="kn">import</span> <span class="n">Request</span>
<span class="kn">from</span> <span class="nn">..response</span> <span class="kn">import</span> <span class="n">SyftError</span>
<span class="kn">from</span> <span class="nn">..response</span> <span class="kn">import</span> <span class="n">SyftException</span>
<span class="kn">from</span> <span class="nn">..response</span> <span class="kn">import</span> <span class="n">SyftNotReady</span>
<span class="kn">from</span> <span class="nn">..response</span> <span class="kn">import</span> <span class="n">SyftSuccess</span>


<div class="viewcode-block" id="EventAlreadyAddedException"><a class="viewcode-back" href="../../../../api_reference/syft.service.project.project.html#syft.service.project.project.EventAlreadyAddedException">[docs]</a><span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">EventAlreadyAddedException</span><span class="p">(</span><span class="n">SyftException</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="k">class</span> <span class="nc">Identity</span><span class="p">(</span><span class="n">SyftObject</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;Identity&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="nb">id</span><span class="p">:</span> <span class="n">UID</span>
    <span class="n">verify_key</span><span class="p">:</span> <span class="n">SyftVerifyKey</span>

    <span class="n">__repr_attrs__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;verify_key&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">verify_key_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ðŸ”‘ </span><span class="si">{</span><span class="n">verify_key_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2"> @ ðŸŸ¢ </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">short</span><span class="p">()</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_client</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">SyftClient</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Identity</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">verify_key</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">verify_key</span><span class="p">)</span>


<div class="viewcode-block" id="NodeIdentity"><a class="viewcode-back" href="../../../../api_reference/syft.service.project.project.html#syft.service.project.project.NodeIdentity">[docs]</a><span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">NodeIdentity</span><span class="p">(</span><span class="n">Identity</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is used to identify the node owner&quot;&quot;&quot;</span>

    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;NodeIdentity&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span></div>


<span class="c1"># Used to Identity data scientist users of the node</span>
<div class="viewcode-block" id="UserIdentity"><a class="viewcode-back" href="../../../../api_reference/syft.service.project.project.html#syft.service.project.project.UserIdentity">[docs]</a><span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">UserIdentity</span><span class="p">(</span><span class="n">Identity</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is used to identify the data scientist users of the node&quot;&quot;&quot;</span>

    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;UserIdentity&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span></div>


<span class="nd">@transform</span><span class="p">(</span><span class="n">NodeMetadata</span><span class="p">,</span> <span class="n">NodeIdentity</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">metadata_to_node_identity</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">keep</span><span class="p">([</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;verify_key&quot;</span><span class="p">])]</span>


<span class="k">class</span> <span class="nc">ProjectEvent</span><span class="p">(</span><span class="n">SyftObject</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectEvent&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">__hash_exclude_attrs__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;event_hash&quot;</span><span class="p">,</span> <span class="s2">&quot;signature&quot;</span><span class="p">]</span>

    <span class="c1"># 1. Creation attrs</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">UID</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">DateTime</span>
    <span class="n">allowed_sub_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># 2. Rebase attrs</span>
    <span class="n">project_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UID</span><span class="p">]</span>
    <span class="n">seq_no</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">prev_event_uid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UID</span><span class="p">]</span>
    <span class="n">prev_event_hash</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">event_hash</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="c1"># 3. Signature attrs</span>
    <span class="n">creator_verify_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SyftVerifyKey</span><span class="p">]</span>
    <span class="n">signature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span>  <span class="c1"># dont use in signing</span>

    <span class="k">def</span> <span class="nf">__repr_syft_nested__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">short_qual_name</span><span class="p">(</span><span class="n">full_name_with_qualname</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">...</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@pydantic</span><span class="o">.</span><span class="n">root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">make_timestamp</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s2">&quot;timestamp&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">or</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DateTime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">_pre_add_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">rebase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="n">prev_event</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">events</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_id</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">prev_event</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_event_uid</span> <span class="o">=</span> <span class="n">prev_event</span><span class="o">.</span><span class="n">id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_event_hash</span> <span class="o">=</span> <span class="n">prev_event</span><span class="o">.</span><span class="n">event_hash</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seq_no</span> <span class="o">=</span> <span class="n">prev_event</span><span class="o">.</span><span class="n">seq_no</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_event_uid</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_event_hash</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">start_hash</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seq_no</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftSuccess</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Sign event first&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Recompute hash</span>
            <span class="n">event_hash_bytes</span><span class="p">,</span> <span class="n">current_hash</span> <span class="o">=</span> <span class="n">create_project_event_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_hash</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Event hash </span><span class="si">{</span><span class="n">current_hash</span><span class="si">}</span><span class="s2"> does not match </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_hash</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">creator_verify_key</span><span class="o">.</span><span class="n">verify_key</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">event_hash_bytes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signature</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Event signature is valid&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed to validate message. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">valid_descendant</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span> <span class="n">prev_event</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Self</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftSuccess</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid</span>

        <span class="k">if</span> <span class="n">prev_event</span><span class="p">:</span>
            <span class="n">prev_event_id</span> <span class="o">=</span> <span class="n">prev_event</span><span class="o">.</span><span class="n">id</span>
            <span class="n">prev_event_hash</span> <span class="o">=</span> <span class="n">prev_event</span><span class="o">.</span><span class="n">event_hash</span>
            <span class="n">prev_seq_no</span> <span class="o">=</span> <span class="n">prev_event</span><span class="o">.</span><span class="n">seq_no</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prev_event_id</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">id</span>
            <span class="n">prev_event_hash</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">start_hash</span>
            <span class="n">prev_seq_no</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_event_uid</span> <span class="o">!=</span> <span class="n">prev_event_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> prev_event_uid: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_event_uid</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;does not match </span><span class="si">{prev_event_id}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_event_hash</span> <span class="o">!=</span> <span class="n">prev_event_hash</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> prev_event_hash: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_event_hash</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;does not match </span><span class="si">{prev_event_hash}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_no</span> <span class="o">!=</span> <span class="n">prev_seq_no</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> seq_no: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_no</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;is not subsequent to </span><span class="si">{prev_seq_no}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_id</span> <span class="o">!=</span> <span class="n">project</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> project_id: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_id</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;does not match </span><span class="si">{project.id}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;parent_event_id&quot;</span><span class="p">):</span>
            <span class="n">parent_event</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">event_id_hashmap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_event_id</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parent_event</span><span class="o">.</span><span class="n">allowed_sub_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> is not a valid subevent&quot;</span> <span class="sa">f</span><span class="s2">&quot;for </span><span class="si">{</span><span class="n">parent_event</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> is valid descendant of </span><span class="si">{</span><span class="n">prev_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signing_key</span><span class="p">:</span> <span class="n">SyftSigningKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">creator_verify_key</span> <span class="o">!=</span> <span class="n">signing_key</span><span class="o">.</span><span class="n">verify_key</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;creator_verify_key has changed from: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">creator_verify_key</span><span class="si">}</span><span class="s2"> to &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">signing_key</span><span class="o">.</span><span class="n">verify_key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Calculate Hash</span>
        <span class="n">event_hash_bytes</span><span class="p">,</span> <span class="n">event_hash</span> <span class="o">=</span> <span class="n">create_project_event_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_hash</span> <span class="o">=</span> <span class="n">event_hash</span>

        <span class="c1"># Sign Hash</span>
        <span class="n">signed_obj</span> <span class="o">=</span> <span class="n">signing_key</span><span class="o">.</span><span class="n">signing_key</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">event_hash_bytes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="n">signed_obj</span><span class="o">.</span><span class="n">_signature</span>

    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftSuccess</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="n">EventAlreadyAddedException</span><span class="p">:</span>  <span class="c1"># nosec</span>
            <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Event already added&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ProjectEventAddObject</span><span class="p">(</span><span class="n">ProjectEvent</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectEventAddObject&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>


<span class="k">class</span> <span class="nc">ProjectEventAddLink</span><span class="p">(</span><span class="n">ProjectEvent</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectEventAddLink&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>


<span class="c1"># Project Sub Event are the events which tend to describe the main events</span>
<span class="c1"># For example, if a project event is created, then the project sub event will be the</span>
<span class="c1"># 1. ProjectThreadMessage</span>
<span class="c1"># 2. Emojis</span>
<span class="c1"># 3. Approval for request based events</span>
<span class="c1"># Mainly these events are used to describe the main events</span>
<span class="c1"># For example, we could make our messaging system to have only one level of thread messages</span>
<span class="c1"># it would also help us define the expected sub events for each event</span>
<span class="c1"># such that only allowed events could be the sub type of the main event</span>
<span class="k">class</span> <span class="nc">ProjectSubEvent</span><span class="p">(</span><span class="n">ProjectEvent</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectSubEvent&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">parent_event_id</span><span class="p">:</span> <span class="n">UID</span>


<span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">ProjectThreadMessage</span><span class="p">(</span><span class="n">ProjectSubEvent</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectThreadMessage&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>


<span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">ProjectMessage</span><span class="p">(</span><span class="n">ProjectEventAddObject</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectMessage&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">allowed_sub_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ProjectThreadMessage</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProjectMessage</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ProjectThreadMessage</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">parent_event_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>


<span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">ProjectRequestResponse</span><span class="p">(</span><span class="n">ProjectSubEvent</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectRequestResponse&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">response</span><span class="p">:</span> <span class="nb">bool</span>


<span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">ProjectRequest</span><span class="p">(</span><span class="n">ProjectEventAddObject</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectRequest&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">linked_request</span><span class="p">:</span> <span class="n">LinkedObject</span>
    <span class="n">allowed_sub_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ProjectRequestResponse</span><span class="p">]</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;linked_request&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_validate_linked_request</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Request</span><span class="p">):</span>
            <span class="n">linked_request</span> <span class="o">=</span> <span class="n">LinkedObject</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">node_uid</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">node_uid</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">linked_request</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">LinkedObject</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;linked_request should be either Request or LinkedObject, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linked_request</span><span class="o">.</span><span class="n">resolve</span>

    <span class="n">__repr_attrs__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;request.status&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.changes[-1].link.service_func_name&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_repr_markdown_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">func_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">changes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">func_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">changes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">service_func_name</span>
        <span class="n">repr_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;request.status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
            <span class="s2">&quot;request.changes[-1].link.service_func_name&quot;</span><span class="p">:</span> <span class="n">func_name</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">markdown_as_class_with_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repr_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">approve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProjectRequestResponse</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">approve</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">ProjectRequestResponse</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent_event_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">accept_by_depositing_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">accept_by_depositing_result</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>

    <span class="c1"># TODO: To add deny requests, when deny functionality is added</span>

    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the status of the request</span>

<span class="sd">        Args:</span>
<span class="sd">            project (Project): Project object to check the status</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Status of the request</span>

<span class="sd">        During Request  status calculation, we do not allow multiple responses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No one has responded to the request yet. Kindly recheck later ðŸ™‚&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The Request Contains more than one Response&quot;</span>
                <span class="s2">&quot;which is currently not possible&quot;</span>
                <span class="s2">&quot;The request should contain only one response&quot;</span>
                <span class="s2">&quot;Kindly re-submit a new request&quot;</span>
                <span class="s2">&quot;The Syft Team is working on this issue to handle multiple responses&quot;</span>
            <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">ProjectRequestResponse</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Response : </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not of type ProjectRequestResponse&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request Status : &quot;</span><span class="p">,</span> <span class="s2">&quot;Approved&quot;</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">response</span> <span class="k">else</span> <span class="s2">&quot;Denied&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">poll_creation_wizard</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">TextWrapper</span><span class="p">(</span><span class="n">initial_indent</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">subsequent_indent</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">welcome_msg</span> <span class="o">=</span> <span class="s2">&quot;Welcome to the Poll Creation Wizard ðŸ§™â€â™‚ï¸ ðŸª„!!!&quot;</span>

    <span class="n">description1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You&#39;ve arrived here because you were interested in a creating poll.</span>
<span class="s2">A poll is a way to gather opinions or information from a group of people.</span>
<span class="s2">It typically involves asking a specific question and providing a set of answer choices for respondents to choose from&quot;&quot;&quot;</span>

    <span class="n">description2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;In a poll, the question is the inquiry being asked of the participants.</span>
<span class="s2">It should be a multiple-choice. The choices are the options that respondents</span>
<span class="s2">are given to select as their answer to the question.For example, a poll question might be</span>
<span class="s2">&quot;Which is your favorite color?&quot; with answer choices of red, blue, green, and yellow.</span>
<span class="s2">Participants can then select the answer that best represents their opinion or preference&quot;&quot;&quot;</span>

    <span class="n">description3</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Since you didn&#39;t pass in questions, choices into .create_poll() (or you did so incorrectly),</span>
<span class="s2">this wizard is going to guide you through the process of creating a poll.&quot;&quot;&quot;</span>

    <span class="n">description4</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;In this wizard, we&#39;re going to ask you for a question and list of choices</span>
<span class="s2">to create the poll. The Questions and choices are converted to strings&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">welcome_msg</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">description1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">description2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">description3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">description4</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Do you understand, and are you ready to proceed? (yes/no)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">consent</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">consent</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;User cancelled poll creation wizard!&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Excellent! Let&#39;s begin!&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="s2">&quot;Question 1: Input a question to ask in the poll&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="s2">&quot;Examples:&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> - What is your favorite type of food?&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> - What day shall we meet?&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> - Do you believe that climate change is a serious problem?&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">question</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
            <span class="s2">&quot;Question 2: Enter the number of choices, you would like to have in the poll&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_choices</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="s2">&quot;Number of choices, should be an integer.Kindly re-enter again.&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="k">continue</span>
        <span class="k">break</span>

    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="s2">&quot;Excellent! Let&#39;s  input each choice for the input&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_choices</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enter Choice </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">choices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="s2">&quot;All done! You have successfully completed the Poll Creation Wizard! ðŸŽ©&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">choices</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">poll_answer_wizard</span><span class="p">(</span><span class="n">poll</span><span class="p">:</span> <span class="n">ProjectMultipleChoicePoll</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">TextWrapper</span><span class="p">(</span><span class="n">initial_indent</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">subsequent_indent</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">welcome_msg</span> <span class="o">=</span> <span class="s2">&quot;Welcome to the Poll Answer Wizard ðŸ§™â€â™‚ï¸ ðŸª„!!!&quot;</span>

    <span class="n">description1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You&#39;ve arrived here because you were interested in a answering a poll.</span>
<span class="s2">A poll is a way to gather opinions or information from a group of people.</span>
<span class="s2">It typically involves asking a specific question and providing a set of answer choices for respondents to choose from&quot;&quot;&quot;</span>

    <span class="n">description2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;In a poll, the question is the inquiry being asked of the participants.</span>
<span class="s2">It should be a multiple-choice. The choices are the options that respondents</span>
<span class="s2">are given to select as their answer to the question.For example, a poll question might be</span>
<span class="s2">&quot;Which is your favorite color?&quot; with answer choices of red, blue, green, and yellow.</span>
<span class="s2">Participants can then select the answer that best represents their opinion or preference&quot;&quot;&quot;</span>

    <span class="n">description3</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Since you didn&#39;t pass in the choices into .answer_poll() (or you did so incorrectly),</span>
<span class="s2">this wizard is going to guide you through the process of answering the poll.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">welcome_msg</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">description1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">description2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">description3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Do you understand, and are you ready to proceed? (yes/no)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">consent</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">consent</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;User cancelled poll answer wizard!&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Excellent! Let&#39;s display the poll question&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Question : </span><span class="si">{</span><span class="n">poll</span><span class="o">.</span><span class="n">question</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">choices</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">choice</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="s2">&quot;Kindly enter your choice for the poll&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">choice</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">choice</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">choices</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Poll Answer should be a natural number between 1 and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="k">continue</span>
        <span class="k">break</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">69</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="s2">&quot;All done! You have successfully completed the Poll Answer Wizard! ðŸŽ©&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">choice</span>


<span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">AnswerProjectPoll</span><span class="p">(</span><span class="n">ProjectSubEvent</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;AnswerProjectPoll&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">answer</span><span class="p">:</span> <span class="nb">int</span>


<span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">ProjectMultipleChoicePoll</span><span class="p">(</span><span class="n">ProjectEventAddObject</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectPoll&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">question</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">choices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">allowed_sub_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">AnswerProjectPoll</span><span class="p">]</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">choices_min_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;choices must have at least one item&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProjectMessage</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">AnswerProjectPoll</span><span class="p">(</span><span class="n">answer</span><span class="o">=</span><span class="n">answer</span><span class="p">,</span> <span class="n">parent_event_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span> <span class="n">pretty_print</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the status of the poll</span>

<span class="sd">        Args:</span>
<span class="sd">            project (Project): Project object to check the status</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Status of the poll</span>

<span class="sd">        During Poll calculation, a user would have answered the poll many times</span>
<span class="sd">        The status of the poll would be calculated based on the latest answer of the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">poll_answers</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">poll_answers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No one has answered this poll&quot;</span>

        <span class="n">respondents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">poll_answer</span> <span class="ow">in</span> <span class="n">poll_answers</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poll_answer</span><span class="p">,</span> <span class="n">AnswerProjectPoll</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Poll answer: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">poll_answer</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not of type AnswerProjectPoll&quot;</span>
                <span class="p">)</span>
            <span class="n">creator_verify_key</span> <span class="o">=</span> <span class="n">poll_answer</span><span class="o">.</span><span class="n">creator_verify_key</span>

            <span class="c1"># Store only the latest response from the user</span>
            <span class="n">identity</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">get_identity_from_key</span><span class="p">(</span><span class="n">creator_verify_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">identity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">respondents</span><span class="p">:</span>
                <span class="n">respondents</span><span class="p">[</span><span class="n">identity</span><span class="p">]</span> <span class="o">=</span> <span class="n">poll_answer</span><span class="o">.</span><span class="n">answer</span>
        <span class="k">if</span> <span class="n">pretty_print</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">respondent</span><span class="p">,</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">respondents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">respondent</span><span class="o">.</span><span class="n">verify_key</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Choices:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">choice</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">respondents</span>


<span class="k">class</span> <span class="nc">ConsensusModel</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">DemocraticConsensusModel</span><span class="p">(</span><span class="n">ConsensusModel</span><span class="p">):</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DemocraticConsensusModel</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">threshold</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">add_code_request_to_project</span><span class="p">(</span>
    <span class="n">project</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ProjectSubmit</span><span class="p">,</span> <span class="n">Project</span><span class="p">],</span>
    <span class="n">code</span><span class="p">:</span> <span class="n">SubmitUserCode</span><span class="p">,</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">SyftClient</span><span class="p">,</span>
    <span class="n">reason</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftError</span><span class="p">,</span> <span class="n">SyftSuccess</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">SubmitUserCode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Currently we are  only support creating requests for SubmitUserCode: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">SyftClient</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Client should be a valid SyftClient&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">reason</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Code Request for Project: </span><span class="si">{</span><span class="n">project</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has been submitted by </span><span class="si">{</span><span class="n">project</span><span class="o">.</span><span class="n">created_by</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">submitted_req</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">request_code_execution</span><span class="p">(</span>
        <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="n">reason</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">submitted_req</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">submitted_req</span>

    <span class="n">request_event</span> <span class="o">=</span> <span class="n">ProjectRequest</span><span class="p">(</span><span class="n">linked_request</span><span class="o">=</span><span class="n">submitted_req</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">ProjectSubmit</span><span class="p">):</span>
        <span class="n">project</span><span class="o">.</span><span class="n">bootstrap_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_event</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">request_event</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span>
        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Code request for &#39;</span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&#39; successfully added to &#39;</span><span class="si">{</span><span class="n">project</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; Project. &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;To see code requests by a client, run `[your_client].code`&quot;</span>
    <span class="p">)</span>


<span class="nd">@serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">SyftObject</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;Project&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">__repr_attrs__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;created_by&quot;</span><span class="p">]</span>
    <span class="n">__attr_unique__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="c1"># TODO: re-add users, members, leader_node_peer</span>
    <span class="n">__hash_exclude_attrs__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;user_signing_key&quot;</span><span class="p">,</span>
        <span class="s2">&quot;start_hash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;users&quot;</span><span class="p">,</span>
        <span class="s2">&quot;members&quot;</span><span class="p">,</span>
        <span class="s2">&quot;leader_node_peer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;event_id_hashmap&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UID</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">members</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeIdentity</span><span class="p">]</span>
    <span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">UserIdentity</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">created_by</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">start_hash</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="c1"># WARNING:  Do not add it to hash keys or print directly</span>
    <span class="n">user_signing_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SyftSigningKey</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Project events</span>
    <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ProjectEvent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">event_id_hashmap</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">UID</span><span class="p">,</span> <span class="n">ProjectEvent</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Project sync</span>
    <span class="n">state_sync_leader</span><span class="p">:</span> <span class="n">NodeIdentity</span>
    <span class="n">leader_node_peer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NodePeer</span><span class="p">]</span>

    <span class="c1"># Unused</span>
    <span class="n">consensus_model</span><span class="p">:</span> <span class="n">ConsensusModel</span>
    <span class="n">project_permissions</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="c1"># store: Dict[UID, Dict[UID, SyftObject]] = {}</span>
    <span class="c1"># permissions: Dict[UID, Dict[UID, Set[str]]] = {}</span>

    <span class="k">def</span> <span class="nf">_coll_repr_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="s2">&quot;created by&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">created_by</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;style&gt;</span>
<span class="s2">            .syft-project </span><span class="se">{{</span><span class="s2">color: </span><span class="si">{</span><span class="n">SURFACE</span><span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">color_theme</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span><span class="se">}}</span>
<span class="s2">            &lt;/style&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;div class=&#39;syft-project&#39;&gt;&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Created by: &lt;/strong&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">created_by</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;p&gt;To see a list of projects, use command `&amp;lt;your_client&amp;gt;.projects`&lt;/p&gt;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_broadcast_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_event</span><span class="p">:</span> <span class="n">ProjectEvent</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftSuccess</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
        <span class="n">leader_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_leader_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_signing_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">leader_client</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">broadcast_event</span><span class="p">(</span><span class="n">project_event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_all_identities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Identity</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">key_in_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verify_key</span><span class="p">:</span> <span class="n">SyftVerifyKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">project_verify_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">identity</span><span class="o">.</span><span class="n">verify_key</span> <span class="k">for</span> <span class="n">identity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_identities</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">verify_key</span> <span class="ow">in</span> <span class="n">project_verify_keys</span>

    <span class="k">def</span> <span class="nf">get_identity_from_key</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">verify_key</span><span class="p">:</span> <span class="n">SyftVerifyKey</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">NodeIdentity</span><span class="p">,</span> <span class="n">UserIdentity</span><span class="p">]]:</span>
        <span class="n">identities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Identity</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_identities</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">identity</span> <span class="ow">in</span> <span class="n">identities</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">identity</span><span class="o">.</span><span class="n">verify_key</span> <span class="o">==</span> <span class="n">verify_key</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">identity</span>
        <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Member with verify key: </span><span class="si">{</span><span class="n">verify_key</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_leader_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signing_key</span><span class="p">:</span> <span class="n">SyftSigningKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SyftClient</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leader_node_peer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Leader node peer is not set&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">signing_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Signing key is required to create leader client&quot;</span><span class="p">)</span>

        <span class="n">verify_key</span> <span class="o">=</span> <span class="n">signing_key</span><span class="o">.</span><span class="n">verify_key</span>

        <span class="n">leader_client</span> <span class="o">=</span> <span class="n">SyftClientSessionCache</span><span class="o">.</span><span class="n">get_client_by_uid_and_verify_key</span><span class="p">(</span>
            <span class="n">verify_key</span><span class="o">=</span><span class="n">verify_key</span><span class="p">,</span> <span class="n">node_uid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">leader_node_peer</span><span class="o">.</span><span class="n">id</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">leader_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">leader_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leader_node_peer</span><span class="o">.</span><span class="n">client_with_key</span><span class="p">(</span><span class="n">signing_key</span><span class="p">)</span>
            <span class="n">SyftClientSessionCache</span><span class="o">.</span><span class="n">add_client_by_uid_and_verify_key</span><span class="p">(</span>
                <span class="n">verify_key</span><span class="o">=</span><span class="n">verify_key</span><span class="p">,</span>
                <span class="n">node_uid</span><span class="o">=</span><span class="n">leader_client</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">syft_client</span><span class="o">=</span><span class="n">leader_client</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">leader_client</span>

    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verify_key</span><span class="p">:</span> <span class="n">SyftVerifyKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># Currently the permission function, initially checks only if the</span>
        <span class="c1"># verify key is present in the project</span>
        <span class="c1"># Later when the project object evolves, we can add more permission checks</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_in_project</span><span class="p">(</span><span class="n">verify_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_append_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">ProjectEvent</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">SyftSigningKey</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftSuccess</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
        <span class="n">prev_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">valid_descendant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prev_event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_broadcast_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftNotReady</span><span class="p">):</span>
            <span class="c1"># If the client if out of sync, sync project updates from leader</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">rebase</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
            <span class="c1"># Retrying broadcasting the event to leader</span>
            <span class="c1"># recursively call _append_event as due to network latency the event could reach late</span>
            <span class="c1"># and other events would be being streamed to the leader</span>
            <span class="c1"># This scenario could lead to starvation of node trying to sync with the leader</span>
            <span class="c1"># This would be solved in our future leaderless approach</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_event</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>

        <span class="n">event_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_copy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_id_hashmap</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_copy</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">event_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">UID</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_id_hashmap</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event</span><span class="p">:</span> <span class="n">ProjectEvent</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">SyftSigningKey</span><span class="p">,</span> <span class="n">SyftClient</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftSuccess</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_ids</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">EventAlreadyAddedException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event already added. </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_signing_key</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">SyftClient</span><span class="p">):</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">credentials</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">SyftSigningKey</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding an event requires a signing key. </span><span class="si">{</span><span class="n">credentials</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">event</span><span class="o">.</span><span class="n">creator_verify_key</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">verify_key</span>
        <span class="n">event</span><span class="o">.</span><span class="n">_pre_add_update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">rebase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">event</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_append_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">validate_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftSuccess</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
        <span class="n">current_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_hash</span>

        <span class="k">def</span> <span class="nf">valid_str</span><span class="p">(</span><span class="n">current_hash</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Project: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> HEAD&lt;</span><span class="si">{</span><span class="n">current_hash</span><span class="si">}</span><span class="s2">&gt; events are valid&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">valid_str</span><span class="p">(</span><span class="n">current_hash</span><span class="p">))</span>

        <span class="n">last_event</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">valid_descendant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_event</span><span class="p">)</span>
            <span class="n">current_hash</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">event_hash</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;âœ…&quot;</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="s2">&quot;âŒ&quot;</span>
                <span class="n">prev_event</span> <span class="o">=</span> <span class="n">last_event</span> <span class="k">if</span> <span class="n">last_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">icon</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;after </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">prev_event</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">prev_event</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="n">last_event</span> <span class="o">=</span> <span class="n">event</span>
        <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">valid_str</span><span class="p">(</span><span class="n">current_hash</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">ProjectEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ProjectEvent</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">parent_event_ids</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_uid</span><span class="p">:</span> <span class="n">UID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProjectEvent</span><span class="p">]:</span>
        <span class="n">parent_event</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">event_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">parent_uid</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_query</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parent_event</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_query</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">event_query</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;More than 1 result for </span><span class="si">{</span><span class="n">parent_uid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># TODO: add a another view for the project objects</span>
    <span class="c1"># to be able to have a Directed Acyclic Graph view of the graph events</span>
    <span class="c1"># this would allow to query the sub events effectively</span>
    <span class="k">def</span> <span class="nf">get_events</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_event_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">UID</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">UID</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">UID</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">UID</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">types</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">types</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">parent_event_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_event_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent_event_ids</span><span class="p">,</span> <span class="n">UID</span><span class="p">):</span>
            <span class="n">parent_event_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_event_ids</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">UID</span><span class="p">):</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">ids</span><span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
            <span class="n">type_check</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">types</span><span class="p">)):</span>
                <span class="n">type_check</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">parent_check</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">parent_event_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s2">&quot;parent_event_id&quot;</span><span class="p">)</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s2">&quot;parent_event_id&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">parent_event_id</span> <span class="ow">in</span> <span class="n">parent_event_ids</span>
            <span class="p">):</span>
                <span class="n">parent_check</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">id_check</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
                <span class="n">id_check</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">type_check</span> <span class="ow">and</span> <span class="n">parent_check</span> <span class="ow">and</span> <span class="n">id_check</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">create_code_request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">SubmitUserCode</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">SyftClient</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">add_code_request_to_project</span><span class="p">(</span>
            <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">code</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="n">reason</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ProjectMessage</span><span class="p">,</span> <span class="n">ProjectThreadMessage</span><span class="p">]]:</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">(</span><span class="n">ProjectMessage</span><span class="p">,</span> <span class="n">ProjectThreadMessage</span><span class="p">)):</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">messages</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">messages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">message_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">top_messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">types</span><span class="o">=</span><span class="n">ProjectMessage</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">top_messages</span><span class="p">:</span>
            <span class="n">message_text</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">creator_verify_key</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_children</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="n">message_text</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&gt; </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">creator_verify_key</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">message_text</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">message_text</span> <span class="o">=</span> <span class="s2">&quot;No messages&quot;</span>
        <span class="k">return</span> <span class="n">message_text</span>

    <span class="k">def</span> <span class="nf">get_last_seq_no</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">message_event</span> <span class="o">=</span> <span class="n">ProjectMessage</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">message_event</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftSuccess</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Message sent successfully&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">reply_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">reply</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">UID</span><span class="p">,</span> <span class="n">ProjectMessage</span><span class="p">,</span> <span class="n">ProjectThreadMessage</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">UID</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">message</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Message id: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_id_hashmap</span><span class="p">[</span><span class="n">message</span><span class="p">]</span>

        <span class="n">reply_event</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ProjectMessage</span><span class="p">,</span> <span class="n">ProjectThreadMessage</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ProjectMessage</span><span class="p">):</span>
            <span class="n">reply_event</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ProjectThreadMessage</span><span class="p">):</span>
            <span class="n">reply_event</span> <span class="o">=</span> <span class="n">ProjectThreadMessage</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="n">reply</span><span class="p">,</span> <span class="n">parent_event_id</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">parent_event_id</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;You can only reply to a message: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Kindly re-check the msg&quot;</span>
            <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">reply_event</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftSuccess</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Reply sent successfully&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">create_poll</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">question</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">choices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">question</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">choices</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">choices</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">question</span><span class="p">,</span> <span class="n">choices</span> <span class="o">=</span> <span class="n">poll_creation_wizard</span><span class="p">()</span>

        <span class="n">poll_event</span> <span class="o">=</span> <span class="n">ProjectMultipleChoicePoll</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">poll_event</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftSuccess</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Poll created successfully&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">answer_poll</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">poll</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">UID</span><span class="p">,</span> <span class="n">ProjectMultipleChoicePoll</span><span class="p">],</span>
        <span class="n">answer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poll</span><span class="p">,</span> <span class="n">UID</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">poll</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Poll id: </span><span class="si">{</span><span class="n">poll</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
            <span class="n">poll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_id_hashmap</span><span class="p">[</span><span class="n">poll</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poll</span><span class="p">,</span> <span class="n">ProjectMultipleChoicePoll</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;You can only reply to a poll: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">poll</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Kindly re-check the poll&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">answer</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">answer</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">poll</span><span class="o">.</span><span class="n">choices</span><span class="p">):</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">poll_answer_wizard</span><span class="p">(</span><span class="n">poll</span><span class="p">)</span>

        <span class="n">answer_event</span> <span class="o">=</span> <span class="n">poll</span><span class="o">.</span><span class="n">answer</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">answer_event</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftSuccess</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Poll answered successfully&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">add_request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">linked_request</span> <span class="o">=</span> <span class="n">LinkedObject</span><span class="o">.</span><span class="n">from_obj</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">node_uid</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">node_uid</span><span class="p">)</span>
        <span class="n">request_event</span> <span class="o">=</span> <span class="n">ProjectRequest</span><span class="p">(</span><span class="n">linked_request</span><span class="o">=</span><span class="n">linked_request</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">request_event</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftSuccess</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Request created successfully&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># Since currently we do not have the notion of denying a request</span>
    <span class="c1"># Adding only approve request, which would later be used to approve or deny a request</span>
    <span class="k">def</span> <span class="nf">approve_request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">request</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">UID</span><span class="p">,</span> <span class="n">ProjectRequest</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">UID</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">request</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Request id: </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_id_hashmap</span><span class="p">[</span><span class="n">request</span><span class="p">]</span>

        <span class="n">request_event</span><span class="p">:</span> <span class="n">ProjectRequestResponse</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">ProjectRequest</span><span class="p">):</span>
            <span class="n">request_event</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">approve</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request_event</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">request_event</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;You can only approve a request: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Kindly re-check the request&quot;</span>
            <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">request_event</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftSuccess</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Request approved successfully&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftSuccess</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sync the latest project with the state sync leader&quot;&quot;&quot;</span>

        <span class="n">leader_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_leader_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_signing_key</span><span class="p">)</span>

        <span class="n">unsynced_events</span> <span class="o">=</span> <span class="n">leader_client</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span>
            <span class="n">project_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">seq_no</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_last_seq_no</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unsynced_events</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">unsynced_events</span>

        <span class="c1"># UI progress bar for syncing</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">unsynced_events</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                <span class="n">curr_val</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[bold white]Syncing... </span><span class="si">{</span><span class="n">curr_val</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unsynced_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">unsynced_events</span><span class="p">),</span>
                <span class="p">)</span>

                <span class="k">while</span> <span class="ow">not</span> <span class="n">progress</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">unsynced_events</span><span class="p">[</span><span class="n">curr_val</span><span class="p">]</span>
                    <span class="n">curr_val</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">progress</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span>
                        <span class="n">task1</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;[bold white]Syncing... </span><span class="si">{</span><span class="n">curr_val</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unsynced_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">event_id_hashmap</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span>
                    <span class="c1"># for a fancy UI view , deliberately slowing the sync</span>
                    <span class="k">if</span> <span class="n">curr_val</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">unsynced_events</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">event_id_hashmap</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span>

        <span class="k">return</span> <span class="n">SyftSuccess</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Synced project  with Leader&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">requests</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Request</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">event</span><span class="o">.</span><span class="n">request</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">ProjectRequest</span><span class="p">)</span>
        <span class="p">]</span>


<span class="nd">@serializable</span><span class="p">(</span><span class="n">without</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bootstrap_events&quot;</span><span class="p">,</span> <span class="s2">&quot;clients&quot;</span><span class="p">])</span>
<span class="k">class</span> <span class="nc">ProjectSubmit</span><span class="p">(</span><span class="n">SyftObject</span><span class="p">):</span>
    <span class="n">__canonical_name__</span> <span class="o">=</span> <span class="s2">&quot;ProjectSubmit&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">SYFT_OBJECT_VERSION_1</span>

    <span class="n">__hash_exclude_attrs__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;start_hash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;users&quot;</span><span class="p">,</span>
        <span class="s2">&quot;members&quot;</span><span class="p">,</span>
        <span class="s2">&quot;clients&quot;</span><span class="p">,</span>
        <span class="s2">&quot;leader_node_route&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bootstrap_events&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># stash rules</span>
    <span class="n">__repr_attrs__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;created_by&quot;</span><span class="p">]</span>
    <span class="n">__attr_unique__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="nb">id</span><span class="p">:</span> <span class="n">UID</span>

    <span class="c1"># Init args</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">members</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">SyftClient</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeIdentity</span><span class="p">]]</span>

    <span class="c1"># These will be automatically populated</span>
    <span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">UserIdentity</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">created_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">clients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SyftClient</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of member clients</span>
    <span class="n">start_hash</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Project sync args</span>
    <span class="n">leader_node_route</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NodeRoute</span><span class="p">]</span>
    <span class="n">state_sync_leader</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NodeIdentity</span><span class="p">]</span>
    <span class="n">bootstrap_events</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ProjectEvent</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Unused at the moment</span>
    <span class="n">project_permissions</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">consensus_model</span><span class="p">:</span> <span class="n">ConsensusModel</span> <span class="o">=</span> <span class="n">DemocraticConsensusModel</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Preserve member SyftClients in a private variable clients</span>
        <span class="c1"># self.members will be List[NodeIdentity] on the node i.e. self.clients = []</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_syft_clients</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">)</span>

        <span class="c1"># If ProjectSubmit is being re-created at node side</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Populate the created_by</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">logged_in_user</span>

        <span class="c1"># Extract information of logged in user from syft clients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="n">UserIdentity</span><span class="o">.</span><span class="n">from_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">]</span>

        <span class="c1"># Convert SyftClients to NodeIdentities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_node_identity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;style&gt;</span>
<span class="s2">            .syft-project-create </span><span class="se">{{</span><span class="s2">color: </span><span class="si">{</span><span class="n">SURFACE</span><span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">color_theme</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span><span class="se">}}</span>
<span class="s2">            &lt;/style&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;div class=&#39;syft-project-create&#39;&gt;&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Created by: &lt;/strong&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">created_by</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span>
        <span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;members&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">verify_members</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">SyftClient</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeIdentity</span><span class="p">]]):</span>
        <span class="c1"># SyftClients must be logged in by the same emails</span>
        <span class="n">clients</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_syft_clients</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">emails</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">client</span><span class="o">.</span><span class="n">logged_in_user</span> <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SyftException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;All clients must be logged in from the same account. Found multiple: </span><span class="si">{</span><span class="n">emails</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_syft_clients</span><span class="p">(</span><span class="n">vals</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">SyftClient</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">NodeIdentity</span><span class="p">]]):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">client</span> <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">vals</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">SyftClient</span><span class="p">)]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_node_identity</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SyftClient</span><span class="p">,</span> <span class="n">NodeIdentity</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">NodeIdentity</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">SyftClient</span><span class="p">):</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">NodeMetadata</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">metadata</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">NodeIdentity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SyftException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;members must be SyftClient or NodeIdentity. Received: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_code_request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">SubmitUserCode</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">SyftClient</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">add_code_request_to_project</span><span class="p">(</span>
            <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">code</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="n">reason</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_all_projects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="c1"># Currently we are assuming that the first member is the leader</span>
        <span class="c1"># This would be changed in our future leaderless approach</span>
        <span class="n">leader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">followers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check for DS role across all members</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pre_submit_checks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">)</span>

            <span class="c1"># Exchange route between leaders and followers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exchange_routes</span><span class="p">(</span><span class="n">leader</span><span class="p">,</span> <span class="n">followers</span><span class="p">)</span>

            <span class="c1"># create project for each node</span>
            <span class="n">projects_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_projects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">)</span>

            <span class="c1"># bootstrap project with pending events on leader node&#39;s project</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bootstrap_events</span><span class="p">(</span><span class="n">projects_map</span><span class="p">[</span><span class="n">leader</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">return_all_projects</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">projects_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">projects_map</span><span class="p">[</span><span class="n">leader</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">SyftException</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SyftError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pre_submit_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SyftClient</span><span class="p">]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if the user can create projects</span>
            <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">can_create_project</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">SyftException</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SyftException</span><span class="p">(</span><span class="s2">&quot;Only Data Scientists can create projects&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_exchange_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leader</span><span class="p">:</span> <span class="n">SyftClient</span><span class="p">,</span> <span class="n">followers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SyftClient</span><span class="p">]):</span>
        <span class="c1"># Since we are implementing a leader based system</span>
        <span class="c1"># To be able to optimize exchanging routes.</span>
        <span class="c1"># We require only the leader to exchange routes with all the members</span>
        <span class="c1"># Meaning if we could guarantee, that the leader node is able to reach the members</span>
        <span class="c1"># the project events could be broadcasted to all the members</span>

        <span class="k">for</span> <span class="n">follower</span> <span class="ow">in</span> <span class="n">followers</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">leader</span><span class="o">.</span><span class="n">exchange_route</span><span class="p">(</span><span class="n">follower</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">SyftException</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">leader_node_route</span> <span class="o">=</span> <span class="n">connection_to_route</span><span class="p">(</span><span class="n">leader</span><span class="o">.</span><span class="n">connection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SyftClient</span><span class="p">]):</span>
        <span class="n">projects</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SyftClient</span><span class="p">,</span> <span class="n">Project</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">create_project</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">SyftException</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="n">projects</span><span class="p">[</span><span class="n">client</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">projects</span>

    <span class="k">def</span> <span class="nf">_bootstrap_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leader_project</span><span class="p">:</span> <span class="n">Project</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_events</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_events</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">leader_project</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SyftError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">SyftException</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">add_members_as_owners</span><span class="p">(</span><span class="n">members</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SyftVerifyKey</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
        <span class="n">owner_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;OWNER_</span><span class="si">{</span><span class="n">member</span><span class="o">.</span><span class="n">verify_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">owner_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">keys</span>


<span class="k">def</span> <span class="nf">elect_leader</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">TransformContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformContext</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;members&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Project&#39;s require at least one member&quot;</span><span class="p">)</span>

    <span class="n">context</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;state_sync_leader&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;members&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">context</span>


<span class="k">def</span> <span class="nf">check_permissions</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">TransformContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransformContext</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;members&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># more than 1 node</span>
        <span class="k">pass</span>

    <span class="c1"># check at least one owner</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;project_permissions&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">project_permissions</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;project_permissions&quot;</span><span class="p">]</span>
        <span class="n">project_permissions</span> <span class="o">=</span> <span class="n">project_permissions</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
            <span class="n">add_members_as_owners</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;members&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;project_permissions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project_permissions</span>

    <span class="k">return</span> <span class="n">context</span>


<span class="nd">@transform</span><span class="p">(</span><span class="n">ProjectSubmit</span><span class="p">,</span> <span class="n">Project</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">new_projectsubmit_to_project</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">elect_leader</span><span class="p">,</span> <span class="n">check_permissions</span><span class="p">]</span>


<div class="viewcode-block" id="hash_object"><a class="viewcode-back" href="../../../../api_reference/syft.service.project.project.html#syft.service.project.project.hash_object">[docs]</a><span class="k">def</span> <span class="nf">hash_object</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hashes an object using sha256</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (Any): Object to be hashed</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Hashed value of the object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hash_bytes</span> <span class="o">=</span> <span class="n">_serialize</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">to_bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">for_hashing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">hash_bytes</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">hash</span><span class="o">.</span><span class="n">digest</span><span class="p">(),</span> <span class="nb">hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span></div>


<span class="k">def</span> <span class="nf">create_project_hash</span><span class="p">(</span><span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="c1"># Creating a custom hash for the project</span>
    <span class="c1"># as the recursive hash is yet to be revamped</span>
    <span class="c1"># for primitives python types</span>

    <span class="c1"># hashing is calculated based on the following attributes</span>
    <span class="c1"># attrs = [&quot;name&quot;, &quot;description&quot;, &quot;created_by&quot;, &quot;members&quot;, &quot;users&quot;]</span>

    <span class="k">return</span> <span class="n">hash_object</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">project</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">project</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="n">project</span><span class="o">.</span><span class="n">created_by</span><span class="p">,</span>
            <span class="p">[</span><span class="n">hash_object</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">members</span><span class="p">],</span>
            <span class="p">[</span><span class="n">hash_object</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">users</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">create_project_event_hash</span><span class="p">(</span><span class="n">project_event</span><span class="p">:</span> <span class="n">ProjectEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="c1"># Creating a custom hash for the project</span>
    <span class="c1"># as the recursive hash is yet to be revamped</span>
    <span class="c1"># for primitives python types.</span>

    <span class="c1"># hashing is calculated based on the following attributes,</span>
    <span class="c1"># attrs = [&quot;id&quot;, &quot;project_id&quot;, &quot;seq no&quot;,</span>
    <span class="c1"># &quot;prev_event_uid&quot;, &quot;prev_event_hash&quot;, &quot;creator_verify_key&quot;]</span>

    <span class="k">return</span> <span class="n">hash_object</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">project_event</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">project_event</span><span class="o">.</span><span class="n">project_id</span><span class="p">,</span>
            <span class="n">project_event</span><span class="o">.</span><span class="n">seq_no</span><span class="p">,</span>
            <span class="n">project_event</span><span class="o">.</span><span class="n">prev_event_uid</span><span class="p">,</span>
            <span class="n">project_event</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">utc_timestamp</span><span class="p">,</span>
            <span class="n">project_event</span><span class="o">.</span><span class="n">prev_event_hash</span><span class="p">,</span>
            <span class="n">hash_object</span><span class="p">(</span><span class="n">project_event</span><span class="o">.</span><span class="n">creator_verify_key</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Openmined Community.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>